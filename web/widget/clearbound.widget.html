<script>
  window.CB_API_URL = "https://clearbound-v2.vercel.app/api/generate";
</script>

<div class="cb-app" data-cb-app>
  <div class="cb-quote" data-cb-quote></div>

  <div class="progress" aria-label="Progress">
    <div class="progressline" data-cb-steps></div>
  </div>

  <div class="card" data-cb-host></div>

  <div class="nav" data-cb-nav>
    <div class="cb-nav-left">
      <button type="button" data-cb-back class="cb-btn-secondary">Previous Step</button>
    </div>
    <div class="cb-nav-right">
      <button type="button" data-cb-next class="cb-btn-primary">Next Step</button>
    </div>
  </div>

  <div data-cb-msg></div>
</div>

<script>
(function(){
  // =========================
  // CONFIG (EDIT THESE 2)
  // =========================
  const OWNER = "<OWNER>";
  const REPO  = "<REPO>";
  const BRANCH_OR_TAG = "main"; // 추천: 유료 전환 직전에는 태그로 고정 (예: "v2.0.7")

  const BASE = `https://cdn.jsdelivr.net/gh/${OWNER}/${REPO}@${BRANCH_OR_TAG}/web/widget/`;
  const CSS_URL = BASE + "clearbound.css";
  const JS_URL  = BASE + "clearbound.widget.js";

  function loadCss(href){
    return new Promise((res, rej)=>{
      // 중복 로드 방지
      if ([...document.querySelectorAll('link[rel="stylesheet"]')].some(l=>l.href === href)) return res();
      const l=document.createElement("link");
      l.rel="stylesheet";
      l.href=href;
      l.onload=res;
      l.onerror=rej;
      document.head.appendChild(l);
    });
  }

  function loadScript(src){
    return new Promise((res, rej)=>{
      // 중복 로드 방지
      if ([...document.querySelectorAll("script")].some(s=>s.src === src)) return res();
      const s=document.createElement("script");
      s.src=src;
      s.defer=true;
      s.onload=res;
      s.onerror=rej;
      document.body.appendChild(s);
    });
  }

  loadCss(CSS_URL)
    .then(()=>loadScript(JS_URL))
    .catch(()=> {
      const root = document.querySelector("[data-cb-app]");
      if (root){
        const msg = root.querySelector("[data-cb-msg]");
        if (msg) msg.innerHTML = "<div class='warn'>Widget failed to load. Check GitHub paths/branch.</div>";
      }
      console.warn("ClearBound widget failed to load.", { CSS_URL, JS_URL });
    });
})();
</script>
